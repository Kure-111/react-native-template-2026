# 開発ルール

## コーディング規約

### スタイリング

**Tailwind CSS (NativeWind) を使用します。**

- `StyleSheet.create()` は使用しない
- `className` プロパティで Tailwind CSS のクラスを指定
- カスタムカラーは `tailwind.config.js` で定義

```jsx
// ✅ 良い例 (Tailwind CSS)
const Button = ({ title }) => (
  <TouchableOpacity className="bg-primary py-4 px-6 rounded-lg">
    <Text className="text-white font-semibold">{title}</Text>
  </TouchableOpacity>
);

// ❌ 悪い例 (StyleSheet)
const Button = ({ title }) => (
  <TouchableOpacity style={styles.button}>
    <Text style={styles.text}>{title}</Text>
  </TouchableOpacity>
);

const styles = StyleSheet.create({
  button: { backgroundColor: '#007AFF', padding: 16 },
  text: { color: '#FFF', fontWeight: '600' },
});
```

### ファイル命名規則

| 種類           | 形式         | 拡張子 | 例                |
| -------------- | ------------ | ------ | ----------------- |
| コンポーネント | PascalCase   | .jsx   | `EventCard.jsx`   |
| サービス       | camelCase    | .js    | `eventService.js` |
| フック         | useCamelCase | .js    | `useEvents.js`    |
| ユーティリティ | camelCase    | .js    | `validation.js`   |
| 定数           | camelCase    | .js    | `constants.js`    |

### 変数・関数の命名規則

#### 変数

- **通常の変数:** camelCase（例：`userName`, `eventList`）
- **定数:** UPPER_SNAKE_CASE（例：`MAX_RETRY_COUNT`, `API_ENDPOINT`）
- **ブール値:** is, has, can, should で始める（例：`isLoading`, `hasError`, `canSubmit`）

#### 関数

**Supabase API に合わせる：**

- データ取得：`selectEvents`, `selectEventById`
- データ挿入：`insertEvent`
- データ更新：`updateUser`
- データ削除：`deleteEvent`

**一般的な関数:**

- 動詞で始める（例：`handleSubmit`, `validateForm`, `fetchUserData`）

### コメント規則

#### JSDoc 形式のコメント（必須）

**全ての関数に JSDoc 形式の日本語コメントを書く**

```javascript
/**
 * イベント一覧を取得する
 * @param {string} userId - ユーザーID
 * @returns {Promise<Array>} イベントの配列
 */
const selectEvents = async (userId) => {
  // 実装
};
```

#### 変数へのコメント

```javascript
/** ユーザー名 */
const userName = 'John Doe';

/** 最大リトライ回数 */
const MAX_RETRY_COUNT = 3;

/** ローディング状態 */
const [isLoading, setIsLoading] = useState(false);
```

#### インラインコメント

- 「なぜ」を説明する（「何を」はコードで表現）
- 複雑なロジックには必ず説明を追加

```javascript
// ユーザーが初回ログイン時のみウェルカム画面を表示
if (isFirstLogin) {
  showWelcomeScreen();
}
```

---

## コード品質の原則

### DRY原則（Don't Repeat Yourself）

- 同じコードを2回以上書かない
- 共通処理は関数化またはコンポーネント化

### KISS原則（Keep It Simple, Stupid）

- シンプルで理解しやすいコードを書く
- 過度な抽象化を避ける

### YAGNI原則（You Aren't Gonna Need It）

- 今必要ない機能は実装しない
- 将来の拡張性よりも現在のシンプルさを優先

### ボーイスカウトルール

- コードを見つけた時よりも良い状態で残す
- 小さな改善を積み重ねる

---

## エラーハンドリング

### 基本方針

1. **エラーは必ず解決する（抑制しない）**
2. **早期にエラーを検出し、明確なエラーメッセージを提供**
3. **外部API・ネットワーク通信は必ず失敗する可能性を考慮**
4. **try-catchでエラーを握りつぶさない**

### 実装例

```javascript
/**
 * イベントデータを取得する
 * @param {string} eventId - イベントID
 * @returns {Promise<Object>} イベントデータ
 * @throws {Error} データ取得に失敗した場合
 */
const fetchEventData = async (eventId) => {
  try {
    const { data, error } = await supabase
      .from('events')
      .select('*')
      .eq('id', eventId)
      .single();

    if (error) {
      throw new Error(`イベントデータの取得に失敗しました: ${error.message}`);
    }

    if (!data) {
      throw new Error('イベントが見つかりませんでした');
    }

    return data;
  } catch (error) {
    // ログを記録
    console.error('fetchEventData error:', error);
    // エラーを再スロー（握りつぶさない）
    throw error;
  }
};
```

---

## セキュリティ

### 環境変数の管理

- APIキー、パスワードは必ず環境変数で管理
- **ハードコード禁止**
- `.env`ファイルは`.gitignore`に追加
- `.env.example`で必要な環境変数を明示

```javascript
// ❌ 悪い例
const SUPABASE_URL = 'https://xxxxx.supabase.co';

// ✅ 良い例
const SUPABASE_URL = process.env.EXPO_PUBLIC_SUPABASE_URL;
```

### 入力検証

- すべての外部入力を検証
- フロントエンド・バックエンド両方で検証

```javascript
/**
 * メールアドレスのバリデーション
 * @param {string} email - メールアドレス
 * @returns {boolean} バリデーション結果
 */
const validateEmail = (email) => {
  if (!email) return false;
  const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return regex.test(email);
};
```

---

## パフォーマンス

### 最適化の原則

1. **推測ではなく計測に基づいて最適化**
2. **必要になるまでリソースの読み込みを遅延**
3. **N+1問題やオーバーフェッチを避ける**

### React Native固有の最適化

```javascript
// React.memo でコンポーネントの再レンダリングを最適化
const EventCard = React.memo(({ event }) => {
  return (
    <View>
      <Text>{event.title}</Text>
    </View>
  );
});

// useCallback でコールバック関数をメモ化
const handlePress = useCallback(() => {
  navigation.navigate('EventDetail', { eventId });
}, [eventId, navigation]);
```

---

## 保守性

### コードの整理

1. **機能追加と同時に既存コードの改善を検討**
2. **使用されていないコードは積極的に削除**
3. **技術的負債は明示的にコメントに記録**

```javascript
// TODO: この処理はパフォーマンスが悪いため、後でキャッシュ機構を追加する必要がある
const fetchAllEvents = async () => {
  // 実装
};
```

---

## 禁止事項

1. ❌ コメントなしのコード
2. ❌ 命名規則を無視
3. ❌ 仕様書を読まずに実装
4. ❌ エラーハンドリング省略
5. ❌ `var`の使用（`const`/`let`を使う）
6. ❌ マジックナンバー（定数化する）
7. ❌ TypeScriptで書く（JavaScriptのみ）
8. ❌ APIキーやパスワードのハードコード
9. ❌ エラーの抑制（try-catchで握りつぶす）
10. ❌ 使用されていないコードの放置
11. ❌ `StyleSheet.create()` の使用（Tailwind CSSを使う）

---

## 依存関係の管理

1. **本当に必要な依存関係のみを追加**
2. **package-lock.jsonを必ずコミット**
3. **新しい依存関係追加前にライセンス、サイズ、メンテナンス状況を確認**
4. **セキュリティパッチのため定期的に更新**

---

## デバッグ

1. **問題を確実に再現できる手順を確立**
2. **最近の変更から調査を開始**
3. **適切なツールを活用（React DevTools, Flipper, etc.）**
4. **調査結果と解決策を記録**

---

## テスト

### テストの方針

- 重要な機能には必ずテストを書く
- エッジケースを考慮
- テストは読みやすく、保守しやすく

### テストの種類

1. **単体テスト:** 関数やコンポーネント単位
2. **結合テスト:** 複数のコンポーネントやサービスの連携
3. **E2Eテスト:** ユーザーのフロー全体

---

## まとめ

このルールは、コードの品質・保守性・セキュリティを保つための基準です。
**必ず守ってください。**
