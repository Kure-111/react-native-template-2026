# プロジェクト仕様書

## プロジェクト概要

生駒祭 2026 で使用する ERP（Enterprise Resource Planning）システム。
Web アプリケーションとして動作し、PC とスマートフォンの両方に対応する。

### 技術スタック

- **フロントエンド:** React Native (Expo) Web
- **バックエンド:** Supabase
- **その他:** Google Apps Script（必要に応じて）
- **使用言語:** JavaScript（TypeScript ではない）

### 対応プラットフォーム

- **PC:** 768px 以上の画面幅
- **スマートフォン:** 768px 未満の画面幅

---

## ナビゲーション構成

サイドバー（Drawer）ナビゲーションを採用している。

### レスポンシブ対応

| 画面サイズ | サイドバー表示 | 操作方法 |
|-----------|--------------|---------|
| PC（768px以上） | 常時表示 | クリックで画面遷移 |
| スマホ（768px未満） | 非表示（オーバーレイ） | ハンバーガーメニュー（☰）で開閉 |

### タブ構成（11項目）

| No. | 画面名 | 状態 | 説明 |
|-----|-------|------|------|
| 1 | 項目1 | 未実装 | 機能の詳細は実装時に定義 |
| 2 | 項目2 | 未実装 | 機能の詳細は実装時に定義 |
| 3 | 項目3 | 未実装 | 機能の詳細は実装時に定義 |
| 4 | 項目4 | 未実装 | 機能の詳細は実装時に定義 |
| 5 | 項目5 | 未実装 | 機能の詳細は実装時に定義 |
| 6 | 項目6 | 未実装 | 機能の詳細は実装時に定義 |
| 7 | 項目7 | 未実装 | 機能の詳細は実装時に定義 |
| 8 | 項目8 | 未実装 | 機能の詳細は実装時に定義 |
| 9 | 項目9 | 未実装 | 機能の詳細は実装時に定義 |
| 10 | 項目10 | 未実装 | 機能の詳細は実装時に定義 |
| 11 | 項目11 | 未実装 | 機能の詳細は実装時に定義 |

---

## ディレクトリ構造

```
project-root/
├── docs/                                # ドキュメント
│   ├── プロジェクト仕様書.md
│   ├── 開発ルール.md
│   ├── GitHubルール.md
│   └── AI用プロンプト/
│       ├── AGENTS.md
│       ├── Gemini.md
│       └── README.md
│
├── src/
│   ├── features/                        # 機能ごとにまとめる
│   │   ├── item1/                       # 項目1
│   │   │   ├── components/             # UI部品
│   │   │   ├── hooks/                  # カスタムフック
│   │   │   ├── screens/
│   │   │   │   └── Item1Screen.jsx    # メイン画面
│   │   │   └── constants.js            # 定数
│   │   │
│   │   ├── item2/                       # 項目2（構造は item1 と同じ）
│   │   ├── item3/                       # 項目3
│   │   ├── item4/                       # 項目4
│   │   ├── item5/                       # 項目5
│   │   ├── item6/                       # 項目6
│   │   ├── item7/                       # 項目7
│   │   ├── item8/                       # 項目8
│   │   ├── item9/                       # 項目9
│   │   ├── item10/                      # 項目10
│   │   └── item11/                      # 項目11
│   │
│   ├── shared/                          # 共通で使うもの
│   │   ├── components/                  # 汎用コンポーネント
│   │   │   ├── PlaceholderContent.jsx  # プレースホルダー表示
│   │   │   └── ScreenErrorBoundary.jsx # エラーバウンダリ
│   │   ├── hooks/                       # 汎用フック
│   │   ├── utils/                       # ユーティリティ関数
│   │   ├── constants/                   # 全体の定数
│   │   └── contexts/                    # Context API
│   │
│   ├── navigation/                      # ナビゲーション
│   │   ├── AppNavigator.jsx            # アプリ全体のナビゲーター
│   │   ├── DrawerNavigator.jsx         # サイドバーナビゲーター
│   │   └── components/
│   │       └── CustomDrawerContent.jsx # カスタムサイドバーUI
│   │
│   ├── services/                        # 共通サービス
│   │   ├── supabase/
│   │   │   └── client.js
│   │   └── gas/
│   │       └── gasApi.js
│   └── assets/                          # 静的ファイル
│
├── .claude/                             # Claude Code設定
│   └── CLAUDE.md
├── .env.example
├── .gitignore
├── app.json
├── package.json
└── README.md
```

### featureディレクトリの構成ルール

各機能（item1〜item11）は以下の構造で実装する。

```
itemX/
├── components/    # その機能専用のUIコンポーネント
├── hooks/         # その機能専用のカスタムフック
├── screens/       # 画面コンポーネント
└── constants.js   # 定数
```

---

## 機能要件

### 項目1〜11

各機能の詳細は実装時に定義する。
左にサイドバーがあり、項目を切り替えられる。のちにsupabaseを用いてユーザごとのアクセス制御を設ける。スマホ用はサイドバーではなくハンバーガーメニューとして集約されている。いずれの項目もフェイクページである。このフェイクページはエラーなどでアクセスできなかった際に表示されるものである。

---

## 画面設計

### 共通レイアウト

#### PC（768px以上）

```
┌─────────────────────────────────────────────────┐
│ ┌───────────┐ ┌─────────────────────────────┐   │
│ │           │ │ ヘッダー                     │   │
│ │ サイドバー │ ├─────────────────────────────┤   │
│ │           │ │                             │   │
│ │ 項目1     │ │ コンテンツエリア              │   │
│ │ 項目2     │ │                             │   │
│ │ ...       │ │                             │   │
│ │ 項目11    │ │                             │   │
│ │           │ │                             │   │
│ └───────────┘ └─────────────────────────────┘   │
└─────────────────────────────────────────────────┘
```

#### スマホ（768px未満）

```
┌───────────────────────┐
│ ☰  ヘッダータイトル    │
├───────────────────────┤
│                       │
│   コンテンツエリア     │
│                       │
│                       │
└───────────────────────┘

※ ☰ タップでサイドバーがオーバーレイ表示
```

### サイドバー

- ヘッダー：「生駒祭 ERP」「2026」
- メニュー項目：項目1〜11
- フッター：バージョン表示（v1.0.0）
- 背景色：ダークテーマ（#1a1a2e）

### 各項目の画面（現在の状態）

未実装の項目1〜11は、プレースホルダー表示となっている。

- 「この機能は現在開発中です」メッセージ
- 画面名の表示

---

## エラーハンドリング設計

### Error Boundary アーキテクチャ

各画面は Error Boundary でラップされており、個別の画面でエラーが発生しても他の画面に影響を与えない。

#### 構成

```
DrawerNavigator
  └── ScreenErrorBoundary（画面ごと）
        └── ItemXScreen
              └── PlaceholderContent
```

#### コンポーネント

| コンポーネント | 役割 |
|--------------|------|
| ScreenErrorBoundary | 画面単位のエラーを捕捉し、フォールバックUIを表示 |
| PlaceholderContent | 開発中画面およびエラー時のフォールバック表示 |

#### 動作フロー

1. **正常時:** 各 ItemXScreen が PlaceholderContent を表示（開発中）
2. **エラー発生時:** ScreenErrorBoundary がエラーを捕捉
3. **フォールバック:** PlaceholderContent をエラーモードで表示
4. **リトライ:** 「ホームに戻る」ボタンで Item1 に遷移可能

#### エラーログ

エラー発生時、以下の情報がコンソールに出力される。

- 画面名（screenName）
- エラーメッセージ
- コンポーネントスタック
- タイムスタンプ

---

## データベース設計

Supabase を使用予定。実際のテーブル設計は機能実装時に定義する。

---

## API 設計

Supabase client と GAS API の基本設定を含む。
実際の API 設計は機能実装時に定義する。

---

## 依存パッケージ

### 主要パッケージ

| パッケージ | 用途 |
|-----------|------|
| expo | React Native 開発フレームワーク |
| react-native-web | Web 対応 |
| @react-navigation/native | ナビゲーション基盤 |
| @react-navigation/drawer | サイドバーナビゲーション |
| react-native-gesture-handler | ジェスチャー操作 |
| react-native-reanimated | アニメーション |
| @supabase/supabase-js | Supabase クライアント |

---

### PWA（Progressive Web App）対応

このWebアプリをPWAとして実装することで、ネイティブアプリのような体験を提供する。

#### PWAの主要機能

1. **インストール可能**
   - Web App Manifestの設定
   - ホーム画面への追加機能
   - スタンドアロンモードでの起動（ブラウザのUIを非表示）
   - アプリアイコン、スプラッシュスクリーンの表示

2. **プッシュ通知**
   - 重要な更新や通知をユーザーに届ける
   - バックグラウンドでの通知受信
   - 通知のクリックでアプリの該当画面へ遷移

3. **レスポンシブ対応**
   - PC（768px以上）とスマートフォン（768px未満）の両方に最適化
   - タッチ操作に対応したUI/UX

4. **パフォーマンス最適化**
   - 高速な初期読み込み
   - プリキャッシュによる即座の画面表示
   - 効率的なリソース管理

#### 実装の技術要素

- **Expo EAS Build**: PWAビルドの生成
- **Workbox**: Service Workerの管理とキャッシュ戦略
- **Web App Manifest**: アプリのメタデータとアイコン設定
- **Push API**: プッシュ通知機能
- **Cache API**: オフライン対応のためのリソースキャッシュ
- **IndexedDB**: オフラインデータの永続化

#### PWA要件

- HTTPSでの配信（必須）
- Service Workerの登録
- manifest.jsonの配置
- アイコン（複数サイズ）の用意
- Lighthouseスコアで90点以上を目指す

## 起動方法

### 開発サーバー起動

```bash
# Web版
npm run web

# または
npx expo start --web
```

### アクセス

ブラウザで `http://localhost:8081` を開く。

---

## ライセンス

MIT License
