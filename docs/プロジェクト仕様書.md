# プロジェクト仕様書

## プロジェクト概要

生駒祭 2026 で使用する ERP（Enterprise Resource Planning）システム。
Web アプリケーションとして動作し、PC とスマートフォンの両方に対応する。

### 技術スタック

- **フロントエンド:** React Native (Expo) Web
- **バックエンド:** Supabase
- **その他:** Google Apps Script（必要に応じて）
- **使用言語:** JavaScript（TypeScript ではない）

### 対応プラットフォーム

- **PC:** 768px 以上の画面幅
- **スマートフォン:** 768px 未満の画面幅

---

## ナビゲーション構成

サイドバー（Drawer）ナビゲーションを採用している。

### レスポンシブ対応

| 画面サイズ | サイドバー表示 | 操作方法 |
|-----------|--------------|---------|
| PC（768px以上） | 常時表示 | クリックで画面遷移 |
| スマホ（768px未満） | 非表示（オーバーレイ） | ハンバーガーメニュー（☰）で開閉 |

### タブ構成（11項目）

| No. | 画面名 | 状態 | 説明 |
|-----|-------|------|------|
| 1 | 項目1 | 未実装 | 機能の詳細は実装時に定義 |
| 2 | 項目2 | 未実装 | 機能の詳細は実装時に定義 |
| 3 | 項目3 | 未実装 | 機能の詳細は実装時に定義 |
| 4 | 項目4 | 未実装 | 機能の詳細は実装時に定義 |
| 5 | 項目5 | 未実装 | 機能の詳細は実装時に定義 |
| 6 | 項目6 | 未実装 | 機能の詳細は実装時に定義 |
| 7 | 項目7 | 未実装 | 機能の詳細は実装時に定義 |
| 8 | 項目8 | 未実装 | 機能の詳細は実装時に定義 |
| 9 | 項目9 | 未実装 | 機能の詳細は実装時に定義 |
| 10 | 項目10 | 未実装 | 機能の詳細は実装時に定義 |
| 11 | 項目11 | 未実装 | 機能の詳細は実装時に定義 |

---

## ディレクトリ構造

```
project-root/
├── docs/                                # ドキュメント
│   ├── プロジェクト仕様書.md
│   ├── 開発ルール.md
│   ├── GitHubルール.md
│   └── AI用プロンプト/
│       ├── AGENTS.md
│       ├── Gemini.md
│       └── README.md
│
├── src/
│   ├── features/                        # 機能ごとにまとめる
│   │   ├── item1/                       # 項目1
│   │   │   ├── components/             # UI部品
│   │   │   ├── hooks/                  # カスタムフック
│   │   │   ├── screens/
│   │   │   │   └── Item1Screen.jsx    # メイン画面
│   │   │   └── constants.js            # 定数
│   │   │
│   │   ├── item2/                       # 項目2（構造は item1 と同じ）
│   │   ├── item3/                       # 項目3
│   │   ├── item4/                       # 項目4
│   │   ├── item5/                       # 項目5
│   │   ├── item6/                       # 項目6
│   │   ├── item7/                       # 項目7
│   │   ├── item8/                       # 項目8
│   │   ├── item9/                       # 項目9
│   │   ├── item10/                      # 項目10
│   │   └── item11/                      # 項目11
│   │
│   ├── shared/                          # 共通で使うもの
│   │   ├── components/                  # 汎用コンポーネント
│   │   │   ├── PlaceholderContent.jsx  # プレースホルダー表示
│   │   │   └── ScreenErrorBoundary.jsx # エラーバウンダリ
│   │   ├── hooks/                       # 汎用フック
│   │   ├── utils/                       # ユーティリティ関数
│   │   ├── constants/                   # 全体の定数
│   │   └── contexts/                    # Context API
│   │
│   ├── navigation/                      # ナビゲーション
│   │   ├── AppNavigator.jsx            # アプリ全体のナビゲーター
│   │   ├── DrawerNavigator.jsx         # サイドバーナビゲーター
│   │   └── components/
│   │       └── CustomDrawerContent.jsx # カスタムサイドバーUI
│   │
│   ├── services/                        # 共通サービス
│   │   ├── supabase/
│   │   │   └── client.js
│   │   └── gas/
│   │       └── gasApi.js
│   └── assets/                          # 静的ファイル
│
├── .claude/                             # Claude Code設定
│   └── CLAUDE.md
├── .env.example
├── .gitignore
├── app.json
├── package.json
└── README.md
```

### featureディレクトリの構成ルール

各機能（item1〜item11）は以下の構造で実装する。

```
itemX/
├── components/    # その機能専用のUIコンポーネント
├── hooks/         # その機能専用のカスタムフック
├── screens/       # 画面コンポーネント
└── constants.js   # 定数
```

---

## 機能要件

### 項目1〜11

各機能の詳細は実装時に定義する。
左にサイドバーがあり、項目を切り替えられる。のちにsupabaseを用いてユーザごとのアクセス制御を設ける。スマホ用はサイドバーではなくハンバーガーメニューとして集約されている。いずれの項目もフェイクページである。このフェイクページはエラーなどでアクセスできなかった際に表示されるものである。

---

## 画面設計

### 共通レイアウト

#### PC（768px以上）

```
┌─────────────────────────────────────────────────┐
│ ┌───────────┐ ┌─────────────────────────────┐   │
│ │           │ │ ヘッダー                     │   │
│ │ サイドバー │ ├─────────────────────────────┤   │
│ │           │ │                             │   │
│ │ 項目1     │ │ コンテンツエリア              │   │
│ │ 項目2     │ │                             │   │
│ │ ...       │ │                             │   │
│ │ 項目11    │ │                             │   │
│ │           │ │                             │   │
│ └───────────┘ └─────────────────────────────┘   │
└─────────────────────────────────────────────────┘
```

#### スマホ（768px未満）

```
┌───────────────────────┐
│ ☰  ヘッダータイトル    │
├───────────────────────┤
│                       │
│   コンテンツエリア     │
│                       │
│                       │
└───────────────────────┘

※ ☰ タップでサイドバーがオーバーレイ表示
```

### サイドバー

- ヘッダー：「生駒祭 ERP」「2026」
- メニュー項目：項目1〜11
- フッター：バージョン表示（v1.0.0）
- 背景色：ダークテーマ（#1a1a2e）

### 各項目の画面（現在の状態）

未実装の項目1〜11は、プレースホルダー表示となっている。

- 「この機能は現在開発中です」メッセージ
- 画面名の表示

---

## エラーハンドリング設計

### Error Boundary アーキテクチャ

各画面は Error Boundary でラップされており、個別の画面でエラーが発生しても他の画面に影響を与えない。

#### 構成

```
DrawerNavigator
  └── ScreenErrorBoundary（画面ごと）
        └── ItemXScreen
              └── PlaceholderContent
```

#### コンポーネント

| コンポーネント | 役割 |
|--------------|------|
| ScreenErrorBoundary | 画面単位のエラーを捕捉し、フォールバックUIを表示 |
| PlaceholderContent | 開発中画面およびエラー時のフォールバック表示 |

#### 動作フロー

1. **正常時:** 各 ItemXScreen が PlaceholderContent を表示（開発中）
2. **エラー発生時:** ScreenErrorBoundary がエラーを捕捉
3. **フォールバック:** PlaceholderContent をエラーモードで表示
4. **リトライ:** 「ホームに戻る」ボタンで Item1 に遷移可能

#### エラーログ

エラー発生時、以下の情報がコンソールに出力される。

- 画面名（screenName）
- エラーメッセージ
- コンポーネントスタック
- タイムスタンプ

---

## データベース設計

Supabase を使用予定。実際のテーブル設計は機能実装時に定義する。

---

## API 設計

Supabase client と GAS API の基本設定を含む。
実際の API 設計は機能実装時に定義する。

---

## 依存パッケージ

### 主要パッケージ

| パッケージ | 用途 |
|-----------|------|
| expo | React Native 開発フレームワーク |
| react-native-web | Web 対応 |
| @react-navigation/native | ナビゲーション基盤 |
| @react-navigation/drawer | サイドバーナビゲーション |
| react-native-gesture-handler | ジェスチャー操作 |
| react-native-reanimated | アニメーション |
| @supabase/supabase-js | Supabase クライアント |

---

### PWA（Progressive Web App）対応

このWebアプリをPWAとして実装することで、ネイティブアプリのような体験を提供する。

#### PWAの主要機能

1. **インストール可能**
   - Web App Manifestの設定
   - ホーム画面への追加機能
   - スタンドアロンモードでの起動（ブラウザのUIを非表示）
   - アプリアイコン、スプラッシュスクリーンの表示

2. **プッシュ通知**
   - 重要な更新や通知をユーザーに届ける
   - バックグラウンドでの通知受信
   - 通知のクリックでアプリの該当画面へ遷移

3. **レスポンシブ対応**
   - PC（768px以上）とスマートフォン（768px未満）の両方に最適化
   - タッチ操作に対応したUI/UX

4. **パフォーマンス最適化**
   - 高速な初期読み込み
   - プリキャッシュによる即座の画面表示
   - 効率的なリソース管理

#### 実装の技術要素

- **Expo EAS Build**: PWAビルドの生成
- **Workbox**: Service Workerの管理とキャッシュ戦略
- **Web App Manifest**: アプリのメタデータとアイコン設定
- **Push API**: プッシュ通知機能
- **Cache API**: オフライン対応のためのリソースキャッシュ
- **IndexedDB**: オフラインデータの永続化

#### PWA要件

- HTTPSでの配信（必須）
- Service Workerの登録
- manifest.jsonの配置
- アイコン（複数サイズ）の用意
- Lighthouseスコアで90点以上を目指す

---

## 通知機能仕様

PWA化が成功したWebアプリに対して、ユーザーへのプッシュ通知機能を追加する。

### 1. 通知機能の概要

#### 目的

- ユーザーに対してリアルタイムに重要な情報を通知する
- バックグラウンドでの通知受信に対応
- 通知クリック時にアプリの該当画面へシームレスに遷移

#### 対応デバイス

- **デスクトップ（PC）**: ブラウザの通知（ネイティブOS通知）
- **モバイル**: PWAによるプッシュ通知（ブラウザベース、またはホーム画面追加後）

### 2. 共有通知関数

ERPシステム全体で共通して使用できる通知機能を提供します。アプリケーションのどこからでも、シンプルな関数呼び出しで通知を送信できます。

#### 通知タイプの管理

通知タイプは拡張可能な設計になっており、新しいタイプを随時追加できます。

**デフォルト通知タイプ**

| タイプID | 説明 | 優先度 | 自動閉じる | 表示スタイル |
|---------|------|--------|-----------|-----------|
| `info` | 一般的な情報通知 | 低 | 7秒 | 青色 |
| `success` | 処理成功時の通知 | 低 | 5秒 | 緑色 |
| `warning` | 注意が必要な内容 | 中 | なし | 橙色 |
| `error` | エラー発生時の通知 | 高 | なし | 赤色 |

**タイプ追加例** （必要に応じて拡張可能）

```
新しい通知タイプが必要な場合、プロジェクト設定で追加します
例：
  - "vendor_stop"（屋台停止通知）
  - "schedule_change"（スケジュール変更通知）
  - "inventory_alert"（在庫アラート）
  - "user_action"（ユーザーアクション通知）
```

#### 共有通知API

全体で共通して使う通知関数：

```javascript
/**
 * ERPシステム共通の通知送信関数
 * @param {Object} params - 通知パラメータ
 * @param {string} params.type - 通知タイプ（info, success, warning, error等）
 * @param {string} params.message - 通知メッセージ本文
 * @param {string|string[]} params.recipientRoles - 通知対象ロール（単一またはリスト）
 * @param {string} [params.title] - 通知タイトル（省略時はタイプから自動生成）
 * @param {string} [params.deepLink] - クリック時の遷移先画面
 * @param {object} [params.metadata] - 追加情報（用途に応じてカスタマイズ可能）
 * @returns {Promise<{success: boolean, notificationId: string}>}
 */
async function sendNotification(params) {
  const {
    type,
    message,
    recipientRoles,
    title,
    deepLink,
    metadata = {}
  } = params;
  
  // 実装詳細
}
```

#### 使用例

**基本的な使い方**

```javascript
// 屋台管理システムから、全屋台マネージャーに停止を通知
await sendNotification({
  type: 'warning',
  message: '屋台番号105麻薬卵が出店停止しました',
  recipientRoles: 'vendor_manager',
  title: '屋台停止のお知らせ',
  deepLink: '/item5/vendor/105'
});
```

```javascript
// 在庫管理システムから、在庫管理者に在庫不足を通知
await sendNotification({
  type: 'error',
  message: 'サークルBの食材が残り20個です。補充が必要です。',
  recipientRoles: 'inventory_manager',
  deepLink: '/item3/inventory/circle_b'
});
```

```javascript
// 会計システムから、会計担当者に日報完了を通知
await sendNotification({
  type: 'success',
  message: '2026年1月15日の日報提出が完了しました',
  recipientRoles: 'accountant',
  deepLink: '/item8/daily-report/2026-01-15'
});
```

```javascript
// スケジュール管理から、全スタッフに変更を通知
await sendNotification({
  type: 'info',
  message: 'メインステージのタイムテーブルが更新されました',
  recipientRoles: 'staff',
  metadata: {
    changeType: 'schedule_update',
    affectedVenue: 'main_stage'
  }
});
```

#### 通知の属性

内部的には以下の構造で保存・配信

```json
{
  "id": "notification_uuid",
  "type": "warning",
  "title": "屋台停止のお知らせ",
  "message": "屋台番号105麻薬卵が出店停止しました",
  "recipientRoles": ["vendor_manager"],
  "targetUserIds": ["user_123", "user_456", "manager_789"],
  "deepLink": "/item5/vendor/105",
  "metadata": {},
  "status": "pending",
  "createdAt": "2026-01-15T10:30:00Z",
  "expiresAt": "2026-01-16T10:30:00Z"
}
```

### 3. 通知の配信方法

#### リアルタイム配信

共有Supabaseのrealtime機能を使用して、ユーザーがアプリを開いている状態でリアルタイムに通知を受け取ります。

- **バックグラウンド受信**: ユーザーがアプリを閉じていても、デバイスに通知が表示される
- **複数ユーザーへの一括配信**: 一度の関数呼び出しで複数ユーザーに配信可能
- **認証ベースのフィルタリング**: ユーザーの権限に基づいて自動的に配信制御

#### 配信フロー

```
アプリケーション内の処理
  ↓
sendNotification() 呼び出し
  ↓
共有Supabase notifications テーブルに記録
  ↓
対象ユーザーのデバイスに配信
  ↓
ユーザー画面に通知表示（アプリ内・OS通知など）
```

### 4. データベース設計（共有Supabase）

ERPシステム全体で使用する統一されたスキーマ：

#### notifications テーブル

| カラム | 型 | 説明 | 必須 |
|--------|-----|------|------|
| id | uuid | 主キー | ◯ |
| type | text | 通知タイプ（info, success, warning, error等） | ◯ |
| title | text | 通知タイトル | ◯ |
| message | text | 通知メッセージ本文 | ◯ |
| recipient_roles | json | 対象ロールの配列 | ◯ |
| target_user_ids | json | 展開後の実際のユーザーIDの配列 | ◯ |
| sent_by | uuid | 送信元ユーザーID | ◯ |
| deep_link | text | クリック時の遷移先画面 | ✕ |
| metadata | jsonb | 追加情報（用途に応じてカスタマイズ） | ✕ |
| status | text | ステータス（pending, sent, failed） | ◯ |
| created_at | timestamp | 作成日時 | ◯ |
| expires_at | timestamp | 有効期限（デフォルト: 24時間後） | ◯ |

#### notification_reads テーブル

個々のユーザーが通知を既読にしたかを追跡：

| カラム | 型 | 説明 |
|--------|-----|------|
| id | uuid | 主キー |
| notification_id | uuid | 通知ID（notifications参照） |
| user_id | uuid | ユーザーID |
| read_at | timestamp | 既読時刻 |
| created_at | timestamp | レコード作成日時 |

#### notification_types テーブル

カスタマイズ可能な通知タイプ管理：

| カラム | 型 | 説明 |
|--------|-----|------|
| id | text | タイプID（PK） |
| display_name | text | 表示用タイプ名 |
| color | text | 表示色（16進数） |
| priority | integer | 優先度（1-5） |
| auto_dismiss_seconds | integer | 自動閉じる秒数（nullなし） |
| icon | text | アイコン画像パス |
| is_active | boolean | 有効/無効フラグ |
| created_at | timestamp | 作成日時 |

### 5. 実装可能な機能

#### どのロールに通知するか

```javascript
// 単一ロールに通知
await sendNotification({
  type: 'info',
  message: 'サークル責任者は確認してください',
  recipientRoles: 'circle_leader'
});

// 複数ロールに通知
await sendNotification({
  type: 'warning',
  message: 'システムメンテナンスの予定があります',
  recipientRoles: ['admin', 'operator']
});

// すべてのスタッフに通知
await sendNotification({
  type: 'error',
  message: '重大なシステムエラーが発生しました',
  recipientRoles: 'staff'
});

// マネージャーロール全員に通知
await sendNotification({
  type: 'info',
  message: 'サークルB用の什器が到着しました',
  recipientRoles: 'manager'
});
```

#### 利用可能なロール一覧

システムで定義されているロール：

```javascript
// ロール定義（constants/userRoles.js）
export const USER_ROLES = {
  ADMIN: 'admin',                      // システム管理者（全機能アクセス可）
  OPERATOR: 'operator',                // オペレーター（ほぼ全機能アクセス可）
  STAFF: 'staff',                      // スタッフ（基本機能のみ）
  
  // 部門別ロール
  VENDOR_MANAGER: 'vendor_manager',    // 屋台担当マネージャー
  INVENTORY_MANAGER: 'inventory_manager',  // 在庫管理者
  ACCOUNTANT: 'accountant',            // 会計担当者
  SCHEDULE_MANAGER: 'schedule_manager',    // スケジュール管理者
  
  // サークル関連ロール
  CIRCLE_LEADER: 'circle_leader',      // サークル責任者
  CIRCLE_MEMBER: 'circle_member',      // サークルメンバー
  
  // その他
  MANAGER: 'manager'                   // 総合マネージャー
};
```

#### 新しいロールが必要な場合

```javascript
// 1. constants/userRoles.js に新しいロールを追加
export const USER_ROLES = {
  // 既存のロール...
  FOOD_SAFETY_MANAGER: 'food_safety_manager',  // 新規：衛生管理者
};

// 2. Supabaseのusersテーブルのrolesカラムを更新
// 3. その後は通常通り使用可能
```

使用例：

```javascript
await sendNotification({
  type: 'warning',
  message: '衛生チェックが必要です',
  recipientRoles: 'food_safety_manager'
});
```

#### 通知タイプのカスタマイズ

新しい通知タイプが必要になった時点で追加可能：

```javascript
// 1. プロジェクト内で新しいタイプを定義（constants/notificationType.js等）
export const NOTIFICATION_TYPES = {
  INFO: 'info',
  SUCCESS: 'success',
  WARNING: 'warning',
  ERROR: 'error',
  VENDOR_STOP: 'vendor_stop',           // 新規：屋台停止
  SCHEDULE_CHANGE: 'schedule_change',   // 新規：スケジュール変更
  INVENTORY_ALERT: 'inventory_alert',   // 新規：在庫アラート
};

// 2. Supabaseの notification_types テーブルに登録
// 管理画面から、または管理スクリプトで追加
```

その後は通常通り使用可能：

```javascript
await sendNotification({
  type: 'schedule_change',  // 新しく追加したタイプ
  message: 'メインステージの時間が変更されました',
  recipientIds: ['staff_001', 'staff_002']
});
```

#### 通知の内容を詳しく知りたいとき

通知をクリックすると、`deepLink`で指定された画面に自動遷移：

```javascript
await sendNotification({
  type: 'warning',
  message: '在庫が少なくなっています',
  recipientIds: 'manager_001',
  deepLink: '/item3/inventory/details'  // クリックで在庫詳細画面へ
});
```

#### 通知の有効期限

デフォルトで24時間有効。不要な古い通知は自動削除：

```javascript
// 通知の有効期限をカスタマイズしたい場合
await sendNotification({
  type: 'info',
  message: '今日のみ有効なお知らせ',
  recipientRoles: 'staff',
  metadata: {
    expiresHours: 12  // 12時間で削除
  }
});
```

### 6. 通知の既読管理

```javascript
// ユーザーが通知をクリック・表示したら自動で既読化
// notification_reads テーブルに記録され、未読バッジから除外される

// アプリ内で未読通知数を取得する場合
const unreadCount = await getUnreadNotificationCount(userId);

// ユーザーの通知履歴を取得
const notifications = await getUserNotifications(userId, {
  limit: 20,
  offset: 0,
  filterByType: 'warning'  // オプション：タイプでフィルタ
});
```

### 7. ディレクトリ構造の追加

```
src/
├── features/
│   └── notifications/                  # 新規：通知機能
│       ├── components/
│       │   ├── NotificationCenter.jsx  # 通知センター（ヘッダーのベルアイコン）
│       │   ├── NotificationBell.jsx    # 未読バッジ付きベルアイコン
│       │   ├── NotificationList.jsx    # 通知リスト表示
│       │   └── NotificationItem.jsx    # 個別通知アイテム
│       ├── hooks/
│       │   ├── useNotifications.js     # 通知一覧取得フック
│       │   ├── useUnreadCount.js       # 未読数取得フック
│       │   └── useNotificationPermission.js # ブラウザ権限管理フック
│       ├── screens/
│       │   └── NotificationScreen.jsx  # 全通知履歴ページ
│       └── constants/
│           └── notificationType.js     # 通知タイプ定義
│
├── shared/
│   ├── services/
│   │   ├── notificationService.js      # 【共有】通知API呼び出し
│   │   ├── sendNotification.js         # 【共有】sendNotification() 関数実装
│   │   └── notificationManager.js      # 【共有】通知管理ロジック
│   ├── hooks/
│   │   └── useNotificationSubscription.js  # 【共有】リアルタイム購読フック
│   └── workers/
│       └── notification-service-worker.js  # Service Worker（プッシュ受信）
│
└── assets/
    └── notification/
        ├── notification-icon.png       # 通知アイコン
        └── notification-badge.png      # 未読バッジ
```

### 8. 共有通知関数の実装場所

`src/shared/services/sendNotification.js` に実装される関数：

```javascript
/**
 * ERPシステム全体で共有する通知送信関数
 * 全モジュール・全画面から呼び出し可能
 * 
 * @example
 * // 屋台管理から呼び出し
 * import { sendNotification } from '@shared/services/sendNotification';
 * 
 * await sendNotification({
 *   type: 'warning',
 *   message: '屋台番号105麻薬卵が出店停止しました',
 *   recipientIds: ['user_123', 'user_456'],
 * });
 */
export async function sendNotification(params) {
  // 実装
}

// 使用例：各機能（item1〜item11）からの呼び出し
// item1（屋台管理）
import { sendNotification } from '@shared/services/sendNotification';
await sendNotification({
  type: 'vendor_stop',
  message: '屋台番号105が停止しました',
  recipientRoles: 'vendor_manager'
});

// item3（在庫管理）
import { sendNotification } from '@shared/services/sendNotification';
await sendNotification({
  type: 'inventory_alert',
  message: 'サークルBの在庫が残り20個です',
  recipientRoles: 'inventory_manager'
});
```


### 11. セキュリティと注意事項

#### 権限チェック

通知送信時に自動的に権限を検証：

- ユーザーは自分に関連する通知のみ受け取れる
- 管理者権限なしで不正な通知を送信できない
- Supabaseの RLS（Row Level Security）で保護

#### 推奨事項

```javascript
// ✅ 正しい使い方：適切なロールを指定
await sendNotification({
  type: 'info',
  message: 'スケジュール更新のお知らせ',
  recipientRoles: 'schedule_manager'
});

// ✅ 複数のロールに通知
await sendNotification({
  type: 'warning',
  message: 'システムメンテナンスのお知らせ',
  recipientRoles: ['admin', 'operator']
});

// ❌ 避けるべき使い方：全員通知
await sendNotification({
  type: 'info',
  message: '全員に通知',
  recipientRoles: ['staff', 'manager', 'admin']
});

// 代わりに適切なロールのみ指定
await sendNotification({
  type: 'info',
  message: 'スケジュール更新',
  recipientRoles: 'staff'
});
```

### 12. 完成後の使用方法

#### 1. インポート

```javascript
// 通知を使いたい画面/コンポーネントで
import { sendNotification } from '@shared/services/sendNotification';
```

#### 2. 関数呼び出し

```javascript
// シンプルな使い方：単一ロール
await sendNotification({
  type: 'success',
  message: 'データが保存されました',
  recipientRoles: 'accountant'
});

// 複数ロールに通知
await sendNotification({
  type: 'warning',
  message: 'メンテナンス予定があります',
  recipientRoles: ['admin', 'operator', 'staff']
});

// マネージャーロール全体に通知
await sendNotification({
  type: 'info',
  message: 'サークル用の連絡事項',
  recipientRoles: 'manager'
});
```

#### 3. 受信側（ユーザー）の体験

- **アプリが開いている場合**: ヘッダーのベルアイコンに未読バッジが表示、通知センターにメッセージが追加
- **アプリが閉じている場合**: OS の通知として表示（スマートフォンの場合はプッシュ通知）
- **クリック**: `deepLink` で指定された画面に自動遷移

#### 4. 通知の追跡

Supabaseの`notifications`テーブルで以下が自動的に記録：

- 誰が送信したか
- どのロールに送信されたか
- 実際に通知を受け取ったユーザーID
- いつ送信されたか
- 誰が既読にしたか

---

## 起動方法

### 開発サーバー起動

```bash
# Web版
npm run web

# または
npx expo start --web
```

### アクセス

ブラウザで `http://localhost:8081` を開く。

---

## ライセンス

MIT License
