# é€šçŸ¥æ©Ÿèƒ½ å®Ÿè£…å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ

## å®Ÿè£…å†…å®¹

ç”Ÿé§’ç¥­ERP 2026ã®é€šçŸ¥æ©Ÿèƒ½ã‚’ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä»•æ§˜æ›¸ã«åŸºã¥ã„ã¦å®Œå…¨ã«å®Ÿè£…ã—ã¾ã—ãŸã€‚

## å®Ÿè£…ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

### 1. å®šæ•°ãƒ•ã‚¡ã‚¤ãƒ«

- `src/shared/constants/userRoles.js` - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«å®šç¾©
- `src/features/notifications/constants/notificationType.js` - é€šçŸ¥ã‚¿ã‚¤ãƒ—å®šç¾©

### 2. å…±æœ‰ã‚µãƒ¼ãƒ“ã‚¹å±¤

- `src/shared/services/sendNotification.js` - **ä¸»è¦ãªé€šçŸ¥é€ä¿¡API**
- `src/shared/services/notificationService.js` - Supabaseé€šä¿¡ã¨CRUDæ“ä½œ
- `src/shared/services/notificationManager.js` - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯

### 3. ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯

- `src/features/notifications/hooks/useNotifications.js` - é€šçŸ¥ä¸€è¦§å–å¾—
- `src/features/notifications/hooks/useUnreadCount.js` - æœªèª­æ•°å–å¾—
- `src/features/notifications/hooks/useNotificationPermission.js` - ãƒ–ãƒ©ã‚¦ã‚¶é€šçŸ¥æ¨©é™
- `src/shared/hooks/useNotificationSubscription.js` - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è³¼èª­

### 4. UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

- `src/features/notifications/components/NotificationBell.jsx` - æœªèª­ãƒãƒƒã‚¸ä»˜ããƒ™ãƒ«ã‚¢ã‚¤ã‚³ãƒ³
- `src/features/notifications/components/NotificationItem.jsx` - å€‹åˆ¥é€šçŸ¥ã‚¢ã‚¤ãƒ†ãƒ 
- `src/features/notifications/components/NotificationList.jsx` - é€šçŸ¥ãƒªã‚¹ãƒˆ
- `src/features/notifications/components/NotificationCenter.jsx` - é€šçŸ¥ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³
- `src/shared/components/AppHeader.jsx` - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆé€šçŸ¥ãƒ™ãƒ«çµ±åˆï¼‰

### 5. ç”»é¢

- `src/features/notifications/screens/NotificationScreen.jsx` - é€šçŸ¥å±¥æ­´ç”»é¢

### 6. Service Worker

- `src/shared/workers/notification-service-worker.js` - ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ç”¨Worker

### 7. ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³çµ±åˆ

- `src/navigation/DrawerNavigator.jsx` - é€šçŸ¥ç”»é¢ã®è¿½åŠ ã€ãƒ˜ãƒƒãƒ€ãƒ¼ã®çµ±åˆ

### 8. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `docs/é€šçŸ¥æ©Ÿèƒ½ã®ä½¿ã„æ–¹.md` - é–‹ç™ºè€…å‘ã‘ä½¿ç”¨ã‚¬ã‚¤ãƒ‰
- `docs/database-setup-notifications.sql` - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—SQL
- `README.md` - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ã®æ›´æ–°

## ä¸»è¦æ©Ÿèƒ½

### âœ… å®Ÿè£…å®Œäº†

#### 1. é€šçŸ¥é€ä¿¡æ©Ÿèƒ½

```javascript
import { sendNotification } from '@shared/services/sendNotification';

await sendNotification({
  type: 'warning',
  message: 'å±‹å°ç•ªå·105éº»è–¬åµãŒå‡ºåº—åœæ­¢ã—ã¾ã—ãŸ',
  recipientRoles: 'vendor_manager',
  title: 'å±‹å°åœæ­¢ã®ãŠçŸ¥ã‚‰ã›',
  deepLink: '/item5/vendor/105'
});
```

- âœ… ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®é€ä¿¡ï¼ˆå˜ä¸€ãƒ»è¤‡æ•°ãƒ­ãƒ¼ãƒ«å¯¾å¿œï¼‰
- âœ… è‡ªå‹•çš„ãªãƒ¦ãƒ¼ã‚¶ãƒ¼IDå±•é–‹
- âœ… æ¨©é™ãƒã‚§ãƒƒã‚¯ï¼ˆç®¡ç†è€…ãƒ»ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®ã¿é€ä¿¡å¯èƒ½ï¼‰
- âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### 2. é€šçŸ¥å—ä¿¡æ©Ÿèƒ½

- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥å—ä¿¡ï¼ˆSupabase Realtimeï¼‰
- âœ… ãƒ–ãƒ©ã‚¦ã‚¶ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥
- âœ… é€šçŸ¥æ¨©é™ã®ç®¡ç†
- âœ… æœªèª­ãƒãƒƒã‚¸è¡¨ç¤º
- âœ… è‡ªå‹•æ›´æ–°ï¼ˆ10ç§’é–“éš”ï¼‰

#### 3. é€šçŸ¥UI

- âœ… ãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒ™ãƒ«ã‚¢ã‚¤ã‚³ãƒ³
- âœ… æœªèª­æ•°ãƒãƒƒã‚¸
- âœ… é€šçŸ¥ã‚»ãƒ³ã‚¿ãƒ¼ï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ï¼‰
- âœ… é€šçŸ¥å±¥æ­´ç”»é¢
- âœ… ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆã‚¿ã‚¤ãƒ—åˆ¥ï¼‰
- âœ… æ—¢èª­ç®¡ç†
- âœ… ä¸€æ‹¬æ—¢èª­æ©Ÿèƒ½

#### 4. ãƒ‡ã‚£ãƒ¼ãƒ—ãƒªãƒ³ã‚¯

- âœ… é€šçŸ¥ã‚¯ãƒªãƒƒã‚¯ã§ç”»é¢é·ç§»
- âœ… ãƒ‘ã‚¹è§£æã¨è‡ªå‹•ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³

#### 5. é€šçŸ¥ã‚¿ã‚¤ãƒ—

ä»¥ä¸‹ã®8ç¨®é¡ã®é€šçŸ¥ã‚¿ã‚¤ãƒ—ã‚’å®Ÿè£…ï¼š

| ã‚¿ã‚¤ãƒ— | è‰² | å„ªå…ˆåº¦ | è‡ªå‹•é–‰ã˜ã‚‹ |
|--------|-----|--------|-----------|
| info | é’ | ä½ | 7ç§’ |
| success | ç·‘ | ä½ | 5ç§’ |
| warning | æ©™ | ä¸­ | ãªã— |
| error | èµ¤ | é«˜ | ãªã— |
| vendor_stop | èµ¤ | é«˜ | ãªã— |
| schedule_change | ç´« | ä¸­ | 10ç§’ |
| inventory_alert | æ©™ | ä¸­ | ãªã— |
| user_action | é’ç´« | ä½ | 5ç§’ |

#### 6. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«

ä»¥ä¸‹ã®10ç¨®é¡ã®ãƒ­ãƒ¼ãƒ«ã‚’å®šç¾©ï¼š

- admin - ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…
- operator - ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼
- staff - ã‚¹ã‚¿ãƒƒãƒ•
- vendor_manager - å±‹å°æ‹…å½“ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
- inventory_manager - åœ¨åº«ç®¡ç†è€…
- accountant - ä¼šè¨ˆæ‹…å½“è€…
- schedule_manager - ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†è€…
- circle_leader - ã‚µãƒ¼ã‚¯ãƒ«è²¬ä»»è€…
- circle_member - ã‚µãƒ¼ã‚¯ãƒ«ãƒ¡ãƒ³ãƒãƒ¼
- manager - ç·åˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼

#### 7. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

å¿…è¦ãªãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã‚¹ã‚­ãƒ¼ãƒï¼š

- `notifications` - é€šçŸ¥ãƒ‡ãƒ¼ã‚¿
- `notification_reads` - æ—¢èª­ç®¡ç†
- `notification_types` - é€šçŸ¥ã‚¿ã‚¤ãƒ—å®šç¾©ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- RLSï¼ˆRow Level Securityï¼‰è¨­å®š
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã®æœ‰åŠ¹åŒ–
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
[ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³] 
    â†“ sendNotification()
[notificationManager] - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€æ¨©é™ãƒã‚§ãƒƒã‚¯ã€ãƒ­ãƒ¼ãƒ«å±•é–‹
    â†“
[notificationService] - Supabaseã¸ã®ä¿å­˜
    â†“
[Supabase notifications ãƒ†ãƒ¼ãƒ–ãƒ«]
    â†“ Realtime
[useNotificationSubscription] - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è³¼èª­
    â†“
[NotificationCenter / AppHeader] - UIè¡¨ç¤º
    â†“
[ãƒ¦ãƒ¼ã‚¶ãƒ¼] - é€šçŸ¥ã‚’ç¢ºèªã€ã‚¯ãƒªãƒƒã‚¯
    â†“
[ç”»é¢é·ç§»] - ãƒ‡ã‚£ãƒ¼ãƒ—ãƒªãƒ³ã‚¯ã§è©²å½“ç”»é¢ã¸
```

### ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ

- **PCï¼ˆ768pxä»¥ä¸Šï¼‰**: å³ä¸Šã«é€šçŸ¥ãƒ™ãƒ«ã€ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³è¡¨ç¤º
- **ã‚¹ãƒãƒ›ï¼ˆ768pxæœªæº€ï¼‰**: å³ä¸Šã«é€šçŸ¥ãƒ™ãƒ«ã€ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬çš„ãªä½¿ã„æ–¹

```javascript
// ä»»æ„ã®ç”»é¢/ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰
import { sendNotification } from '@shared/services/sendNotification';

// å˜ä¸€ãƒ­ãƒ¼ãƒ«ã«é€šçŸ¥
await sendNotification({
  type: 'info',
  message: 'ãƒ‡ãƒ¼ã‚¿ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ',
  recipientRoles: 'staff'
});

// è¤‡æ•°ãƒ­ãƒ¼ãƒ«ã«é€šçŸ¥
await sendNotification({
  type: 'warning',
  message: 'ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹äºˆå®š',
  recipientRoles: ['admin', 'operator', 'staff']
});

// ãƒ‡ã‚£ãƒ¼ãƒ—ãƒªãƒ³ã‚¯ä»˜ã
await sendNotification({
  type: 'error',
  message: 'åœ¨åº«ãŒä¸è¶³ã—ã¦ã„ã¾ã™',
  recipientRoles: 'inventory_manager',
  deepLink: '/item3/inventory/123'
});
```

### å®Ÿè£…ä¾‹

#### å±‹å°ç®¡ç†ã‹ã‚‰é€šçŸ¥

```javascript
// src/features/item5/components/VendorManagement.jsx
const handleVendorStop = async (vendorId, vendorName) => {
  // å±‹å°ã‚’åœæ­¢...
  
  await sendNotification({
    type: 'vendor_stop',
    message: `å±‹å°ç•ªå·${vendorId}ã€Œ${vendorName}ã€ãŒå‡ºåº—åœæ­¢ã—ã¾ã—ãŸ`,
    recipientRoles: ['vendor_manager', 'admin'],
    deepLink: `/item5/vendor/${vendorId}`
  });
};
```

#### åœ¨åº«ç®¡ç†ã‹ã‚‰é€šçŸ¥

```javascript
// src/features/item3/components/InventoryAlert.jsx
if (item.quantity < item.threshold) {
  await sendNotification({
    type: 'inventory_alert',
    message: `${item.name}ã®åœ¨åº«ãŒæ®‹ã‚Š${item.quantity}å€‹ã§ã™`,
    recipientRoles: 'inventory_manager',
    deepLink: `/item3/inventory/${item.id}`
  });
}
```

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

Supabaseãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ `docs/database-setup-notifications.sql` ã‚’å®Ÿè¡Œ

### 2. ç’°å¢ƒå¤‰æ•°

`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã«Supabaseèªè¨¼æƒ…å ±ã‚’è¨­å®šæ¸ˆã¿

### 3. é€šçŸ¥æ¨©é™ã®è¦æ±‚

åˆå›èµ·å‹•æ™‚ã€ãƒ–ãƒ©ã‚¦ã‚¶é€šçŸ¥ã®æ¨©é™ã‚’è¦æ±‚

### 4. ä½¿ç”¨é–‹å§‹

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã©ã“ã‹ã‚‰ã§ã‚‚ `sendNotification()` ã‚’å‘¼ã³å‡ºã—å¯èƒ½

## æ‹¡å¼µæ–¹æ³•

### æ–°ã—ã„é€šçŸ¥ã‚¿ã‚¤ãƒ—ã‚’è¿½åŠ 

`src/features/notifications/constants/notificationType.js` ã‚’ç·¨é›†

```javascript
export const NOTIFICATION_TYPES = {
  // ...æ—¢å­˜ã®ã‚¿ã‚¤ãƒ—
  MY_NEW_TYPE: 'my_new_type'
};

export const NOTIFICATION_TYPE_CONFIG = {
  // ...æ—¢å­˜ã®è¨­å®š
  [NOTIFICATION_TYPES.MY_NEW_TYPE]: {
    displayName: 'æ–°ã‚¿ã‚¤ãƒ—',
    color: '#FF6B6B',
    priority: 2,
    autoDismissSeconds: 8,
    icon: 'ğŸ””'
  }
};
```

### æ–°ã—ã„ãƒ­ãƒ¼ãƒ«ã‚’è¿½åŠ 

1. `src/shared/constants/userRoles.js` ã«ãƒ­ãƒ¼ãƒ«ã‚’è¿½åŠ 
2. Supabaseã® `users` ãƒ†ãƒ¼ãƒ–ãƒ«ã§è©²å½“ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¨­å®š
3. ã™ãã«ä½¿ç”¨å¯èƒ½

## ãƒ†ã‚¹ãƒˆ

### æ‰‹å‹•ãƒ†ã‚¹ãƒˆ

1. ã‚¢ãƒ—ãƒªã‚’èµ·å‹•
2. ãƒ­ã‚°ã‚¤ãƒ³
3. é–‹ç™ºè€…ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œï¼š

```javascript
import { sendNotification } from './src/shared/services/sendNotification';

await sendNotification({
  type: 'info',
  message: 'ãƒ†ã‚¹ãƒˆé€šçŸ¥',
  recipientRoles: 'staff'
});
```

4. å³ä¸Šã®ãƒ™ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã«æœªèª­ãƒãƒƒã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
5. ãƒ™ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é€šçŸ¥ã‚»ãƒ³ã‚¿ãƒ¼ã‚’é–‹ã
6. é€šçŸ¥ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

## ä»Šå¾Œã®æ”¹å–„ç‚¹

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ï¼ˆæœªå®Ÿè£…ï¼‰

- [ ] ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã®çµ±åˆ
- [ ] Slacké€šçŸ¥ã®çµ±åˆ
- [ ] é€šçŸ¥ã®ä¸€æ‹¬æ“ä½œï¼ˆå‰Šé™¤ã€ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ï¼‰
- [ ] é€šçŸ¥ã®æ¤œç´¢æ©Ÿèƒ½
- [ ] é€šçŸ¥ã®å„ªå…ˆåº¦ã«ã‚ˆã‚‹ã‚½ãƒ¼ãƒˆ
- [ ] é€šçŸ¥ã®æ—¢èª­/æœªèª­ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
- [ ] é€šçŸ¥éŸ³ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
- [ ] é€šçŸ¥ã®é€ä¿¡å±¥æ­´ï¼ˆç®¡ç†è€…ç”¨ï¼‰
- [ ] é€šçŸ¥ã®é…ä¿¡çµ±è¨ˆ

## ã¾ã¨ã‚

é€šçŸ¥æ©Ÿèƒ½ã¯å®Œå…¨ã«å®Ÿè£…ã•ã‚Œã€ã™ãã«ä½¿ç”¨å¯èƒ½ã§ã™ã€‚

- âœ… å…±æœ‰é€šçŸ¥API (`sendNotification`)
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å—ä¿¡
- âœ… ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥
- âœ… æœªèª­ãƒãƒƒã‚¸
- âœ… é€šçŸ¥ã‚»ãƒ³ã‚¿ãƒ¼
- âœ… é€šçŸ¥å±¥æ­´ç”»é¢
- âœ… ãƒ‡ã‚£ãƒ¼ãƒ—ãƒªãƒ³ã‚¯
- âœ… ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹é…ä¿¡
- âœ… 8ç¨®é¡ã®é€šçŸ¥ã‚¿ã‚¤ãƒ—
- âœ… 10ç¨®é¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«
- âœ… ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–UI
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ
- âœ… ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œå‚™

è©³ç´°ãªä½¿ã„æ–¹ã¯ `docs/é€šçŸ¥æ©Ÿèƒ½ã®ä½¿ã„æ–¹.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
